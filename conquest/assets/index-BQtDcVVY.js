(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();function M(n){const t=[...n];for(let a=t.length-1;a>0;a--){const i=Math.floor(Math.random()*(a+1));[t[a],t[i]]=[t[i],t[a]]}return t}function Z(n,t){return M(n).slice(0,t)}class ee{constructor(t){this.countries=t.map(a=>({...a,owner:null})),this.pool=this.countries.filter(a=>a.isMajor),this._questionQueue=M([...this.pool.map(a=>a.id)]),this.currentTargetId=null,this.players=["p1","p2"],this._turnIndex=0,this.mode="single",this.totalCountries=this.pool.length}reset(){this.countries.forEach(t=>{t.owner=null}),this._questionQueue=M([...this.pool.map(t=>t.id)]),this.currentTargetId=null,this._turnIndex=0}nextQuestion(){if(this._questionQueue.length===0)return null;const t=this._questionQueue.shift();this.currentTargetId=t;const a=this.byId(t),i=M([{id:a.id,label:a.name},...Z(this.pool.filter(r=>r.id!==t),2).map(r=>({id:r.id,label:r.name}))]),o=M([{id:a.id,label:a.capital},...Z(this.pool.filter(r=>r.id!==t),2).map(r=>({id:r.id,label:r.capital}))]);return{flag:a.flag,countryOptions:i,capitalOptions:o}}answer(t,a){const i=this.byId(this.currentTargetId),o=this.currentPlayer(),r=t===i.id&&a===i.id;return r&&(i.owner=o),this.mode==="two"&&(r||this._questionQueue.push(this.currentTargetId),this.nextTurn()),{correct:r,correctCountryName:i.name,correctCapitalName:i.capital}}skip(){this.currentTargetId!=null&&this._questionQueue.push(this.currentTargetId),this.mode==="two"&&this.nextTurn()}conqueredCount(){return this.pool.filter(t=>t.owner==="p1").length}score(t){return this.pool.filter(a=>a.owner===t).length}isWin(){return this.mode==="single"?this.score("p1")>Math.floor(this.totalCountries/2):this.score("p1")>Math.floor(this.totalCountries/2)||this.score("p2")>Math.floor(this.totalCountries/2)}winnerPlayer(){return this.mode==="single"?this.score("p1")>Math.floor(this.totalCountries/2)?"p1":null:this.score("p1")>Math.floor(this.totalCountries/2)?"p1":this.score("p2")>Math.floor(this.totalCountries/2)?"p2":null}getCountryFillClass(t){const a=this.byId(t);return a?a.owner==="p1"?"conquered-p1":a.owner==="p2"?"conquered-p2":"":""}byId(t){return this.countries.find(a=>a.id===t)}currentPlayer(){return this.players[this._turnIndex%this.players.length]}setMode(t){this.mode=t}nextTurn(){this._turnIndex=(this._turnIndex+1)%this.players.length}}function te({countries:n,onCountryClick:t,getFillClass:a}){const i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg");o.setAttribute("viewBox","0 36 720 288"),o.setAttribute("preserveAspectRatio","xMidYMid meet"),o.setAttribute("class","map-svg"),o.setAttribute("role","img"),o.setAttribute("aria-label","Simplified world map");const r=document.createElementNS(i,"rect");r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width","720"),r.setAttribute("height","360"),r.setAttribute("fill","#0b1220"),o.appendChild(r);const s=document.createElementNS(i,"g");s.setAttribute("fill","#94a3b8"),s.setAttribute("opacity","0.16"),s.setAttribute("pointer-events","none");const d=["M60,60 L110,50 L160,58 L205,70 L245,85 L260,95 L240,110 L215,118 L198,132 L180,150 L155,162 L130,178 L115,190 L100,205 L85,198 L75,175 Z","M240,195 L260,200 L280,215 L300,235 L295,260 L285,285 L275,310 L260,330 L245,320 L250,295 L245,275 L235,255 L230,230 Z","M345,98 L370,92 L400,96 L420,105 L435,115 L435,130 L412,140 L392,142 L372,136 L350,122 Z","M410,155 L435,150 L465,155 L485,170 L495,190 L490,215 L480,240 L470,265 L455,285 L440,290 L430,265 L425,245 L420,225 L410,200 Z","M450,140 L485,140 L510,145 L515,160 L505,175 L490,175 L470,165 L455,155 Z","M430,85 L470,80 L520,85 L565,95 L600,110 L625,125 L650,140 L665,155 L665,170 L640,178 L600,172 L570,166 L545,160 L520,155 L500,150 L470,140 L445,120 Z","M545,205 L570,205 L590,210 L585,220 L560,220 L545,215 Z","M640,150 L650,155 L650,170 L640,175 Z","M600,255 L635,255 L675,265 L680,285 L650,300 L615,300 L600,285 Z"];for(const m of d){const u=document.createElementNS(i,"path");u.setAttribute("d",m),s.appendChild(u)}return o.appendChild(s),n.forEach(m=>{const u=document.createElementNS(i,"path");u.setAttribute("d",m.path),u.setAttribute("tabindex","0"),u.setAttribute("data-id",m.id),u.setAttribute("class",`country ${a?a(m.id):""}`),u.addEventListener("click",()=>t&&t(m.id)),u.addEventListener("keypress",_=>{(_.key==="Enter"||_.key===" ")&&t&&t(m.id)}),o.appendChild(u)}),o}const Q=[{id:"usa",name:"United States",capital:"Washington, D.C.",flag:"ðŸ‡ºðŸ‡¸",flagCode:"us",isMajor:!0,path:"M120,120 h90 v30 h-20 v20 h-40 v-10 h-30 z"},{id:"can",name:"Canada",capital:"Ottawa",flag:"ðŸ‡¨ðŸ‡¦",flagCode:"ca",isMajor:!0,path:"M110,80 h110 v30 h-110 z"},{id:"mex",name:"Mexico",capital:"Mexico City",flag:"ðŸ‡²ðŸ‡½",flagCode:"mx",isMajor:!0,path:"M140,170 h40 v20 h-20 v10 h-20 z"},{id:"bra",name:"Brazil",capital:"BrasÃ­lia",flag:"ðŸ‡§ðŸ‡·",flagCode:"br",isMajor:!0,path:"M240,220 h40 v20 h-10 v20 h-30 z"},{id:"arg",name:"Argentina",capital:"Buenos Aires",flag:"ðŸ‡¦ðŸ‡·",flagCode:"ar",isMajor:!0,path:"M250,270 h20 v30 h-20 z"},{id:"uk",name:"United Kingdom",capital:"London",flag:"ðŸ‡¬ðŸ‡§",flagCode:"gb",isMajor:!0,path:"M380,115 h10 v10 h-10 z"},{id:"fra",name:"France",capital:"Paris",flag:"ðŸ‡«ðŸ‡·",flagCode:"fr",isMajor:!0,path:"M390,130 h20 v15 h-20 z"},{id:"deu",name:"Germany",capital:"Berlin",flag:"ðŸ‡©ðŸ‡ª",flagCode:"de",isMajor:!0,path:"M410,120 h18 v16 h-18 z"},{id:"esp",name:"Spain",capital:"Madrid",flag:"ðŸ‡ªðŸ‡¸",flagCode:"es",isMajor:!0,path:"M375,145 h25 v12 h-25 z"},{id:"ita",name:"Italy",capital:"Rome",flag:"ðŸ‡®ðŸ‡¹",flagCode:"it",isMajor:!0,path:"M420,145 h10 v20 h-10 z"},{id:"rus",name:"Russia",capital:"Moscow",flag:"ðŸ‡·ðŸ‡º",flagCode:"ru",isMajor:!0,path:"M420,80 h150 v30 h-150 z"},{id:"tur",name:"Turkey",capital:"Ankara",flag:"ðŸ‡¹ðŸ‡·",flagCode:"tr",isMajor:!0,path:"M440,150 h40 v12 h-40 z"},{id:"egy",name:"Egypt",capital:"Cairo",flag:"ðŸ‡ªðŸ‡¬",flagCode:"eg",isMajor:!0,path:"M450,180 h25 v18 h-25 z"},{id:"zaf",name:"South Africa",capital:"Pretoria",flag:"ðŸ‡¿ðŸ‡¦",flagCode:"za",isMajor:!0,path:"M470,270 h30 v20 h-30 z"},{id:"nga",name:"Nigeria",capital:"Abuja",flag:"ðŸ‡³ðŸ‡¬",flagCode:"ng",isMajor:!0,path:"M430,210 h25 v18 h-25 z"},{id:"ind",name:"India",capital:"New Delhi",flag:"ðŸ‡®ðŸ‡³",flagCode:"in",isMajor:!0,path:"M520,180 h40 v25 h-40 z"},{id:"chn",name:"China",capital:"Beijing",flag:"ðŸ‡¨ðŸ‡³",flagCode:"cn",isMajor:!0,path:"M560,150 h70 v30 h-70 z"},{id:"jpn",name:"Japan",capital:"Tokyo",flag:"ðŸ‡¯ðŸ‡µ",flagCode:"jp",isMajor:!0,path:"M645,160 h12 v18 h-12 z"},{id:"aus",name:"Australia",capital:"Canberra",flag:"ðŸ‡¦ðŸ‡º",flagCode:"au",isMajor:!0,path:"M620,260 h60 v25 h-60 z"},{id:"idn",name:"Indonesia",capital:"Jakarta",flag:"ðŸ‡®ðŸ‡©",flagCode:"id",isMajor:!0,path:"M560,230 h45 v10 h-45 z"},{id:"sau",name:"Saudi Arabia",capital:"Riyadh",flag:"ðŸ‡¸ðŸ‡¦",flagCode:"sa",isMajor:!0,path:"M480,180 h28 v18 h-28 z"},{id:"irn",name:"Iran",capital:"Tehran",flag:"ðŸ‡®ðŸ‡·",flagCode:"ir",isMajor:!0,path:"M500,165 h30 v18 h-30 z"},{id:"kor",name:"South Korea",capital:"Seoul",flag:"ðŸ‡°ðŸ‡·",flagCode:"kr",isMajor:!0,path:"M635,155 h8 v12 h-8 z"},{id:"pak",name:"Pakistan",capital:"Islamabad",flag:"ðŸ‡µðŸ‡°",flagCode:"pk",isMajor:!0,path:"M510,175 h20 v15 h-20 z"},{id:"ukr",name:"Ukraine",capital:"Kyiv",flag:"ðŸ‡ºðŸ‡¦",flagCode:"ua",isMajor:!0,path:"M440,110 h28 v16 h-28 z"},{id:"prt",name:"Portugal",capital:"Lisbon",flag:"ðŸ‡µðŸ‡¹",flagCode:"pt",isMajor:!0,path:"M365,147 h8 v12 h-8 z"},{id:"bel",name:"Belgium",capital:"Brussels",flag:"ðŸ‡§ðŸ‡ª",flagCode:"be",isMajor:!0,path:"M405,125 h8 v10 h-8 z"},{id:"nld",name:"Netherlands",capital:"Amsterdam",flag:"ðŸ‡³ðŸ‡±",flagCode:"nl",isMajor:!0,path:"M405,115 h10 v8 h-10 z"},{id:"pol",name:"Poland",capital:"Warsaw",flag:"ðŸ‡µðŸ‡±",flagCode:"pl",isMajor:!0,path:"M430,115 h20 v12 h-20 z"},{id:"swe",name:"Sweden",capital:"Stockholm",flag:"ðŸ‡¸ðŸ‡ª",flagCode:"se",isMajor:!0,path:"M405,95 h16 v14 h-16 z"},{id:"nor",name:"Norway",capital:"Oslo",flag:"ðŸ‡³ðŸ‡´",flagCode:"no",isMajor:!0,path:"M390,95 h14 v14 h-14 z"},{id:"rou",name:"Romania",capital:"Bucharest",flag:"ðŸ‡·ðŸ‡´",flagCode:"ro",isMajor:!0,path:"M435,135 h18 v12 h-18 z"},{id:"grc",name:"Greece",capital:"Athens",flag:"ðŸ‡¬ðŸ‡·",flagCode:"gr",isMajor:!0,path:"M430,160 h14 v10 h-14 z"},{id:"mar",name:"Morocco",capital:"Rabat",flag:"ðŸ‡²ðŸ‡¦",flagCode:"ma",isMajor:!0,path:"M400,170 h18 v12 h-18 z"},{id:"dza",name:"Algeria",capital:"Algiers",flag:"ðŸ‡©ðŸ‡¿",flagCode:"dz",isMajor:!0,path:"M420,180 h28 v18 h-28 z"},{id:"eth",name:"Ethiopia",capital:"Addis Ababa",flag:"ðŸ‡ªðŸ‡¹",flagCode:"et",isMajor:!0,path:"M470,210 h18 v14 h-18 z"},{id:"ken",name:"Kenya",capital:"Nairobi",flag:"ðŸ‡°ðŸ‡ª",flagCode:"ke",isMajor:!0,path:"M485,220 h16 v12 h-16 z"},{id:"cod",name:"DR Congo",capital:"Kinshasa",flag:"ðŸ‡¨ðŸ‡©",flagCode:"cd",isMajor:!0,path:"M460,230 h24 v18 h-24 z"},{id:"tza",name:"Tanzania",capital:"Dodoma",flag:"ðŸ‡¹ðŸ‡¿",flagCode:"tz",isMajor:!0,path:"M480,235 h18 v16 h-18 z"},{id:"mar2",name:"Tunisia",capital:"Tunis",flag:"ðŸ‡¹ðŸ‡³",flagCode:"tn",isMajor:!0,path:"M430,175 h10 v10 h-10 z"},{id:"col",name:"Colombia",capital:"BogotÃ¡",flag:"ðŸ‡¨ðŸ‡´",flagCode:"co",isMajor:!0,path:"M230,200 h18 v14 h-18 z"},{id:"ven",name:"Venezuela",capital:"Caracas",flag:"ðŸ‡»ðŸ‡ª",flagCode:"ve",isMajor:!0,path:"M248,198 h20 v12 h-20 z"},{id:"per",name:"Peru",capital:"Lima",flag:"ðŸ‡µðŸ‡ª",flagCode:"pe",isMajor:!0,path:"M240,240 h18 v22 h-18 z"},{id:"chl",name:"Chile",capital:"Santiago",flag:"ðŸ‡¨ðŸ‡±",flagCode:"cl",isMajor:!0,path:"M235,265 h10 v35 h-10 z"},{id:"bol",name:"Bolivia",capital:"Sucre",flag:"ðŸ‡§ðŸ‡´",flagCode:"bo",isMajor:!0,path:"M258,240 h16 v16 h-16 z"},{id:"arg2",name:"Uruguay",capital:"Montevideo",flag:"ðŸ‡ºðŸ‡¾",flagCode:"uy",isMajor:!0,path:"M265,285 h12 v10 h-12 z"},{id:"irq",name:"Iraq",capital:"Baghdad",flag:"ðŸ‡®ðŸ‡¶",flagCode:"iq",isMajor:!0,path:"M490,160 h16 v12 h-16 z"},{id:"isr",name:"Israel",capital:"Jerusalem",flag:"ðŸ‡®ðŸ‡±",flagCode:"il",isMajor:!0,path:"M470,170 h6 v10 h-6 z"},{id:"kaz",name:"Kazakhstan",capital:"Astana",flag:"ðŸ‡°ðŸ‡¿",flagCode:"kz",isMajor:!0,path:"M500,130 h40 v16 h-40 z"},{id:"mng",name:"Mongolia",capital:"Ulaanbaatar",flag:"ðŸ‡²ðŸ‡³",flagCode:"mn",isMajor:!0,path:"M560,130 h30 v14 h-30 z"},{id:"bgd",name:"Bangladesh",capital:"Dhaka",flag:"ðŸ‡§ðŸ‡©",flagCode:"bd",isMajor:!0,path:"M545,190 h10 v8 h-10 z"},{id:"tha",name:"Thailand",capital:"Bangkok",flag:"ðŸ‡¹ðŸ‡­",flagCode:"th",isMajor:!0,path:"M550,200 h12 v12 h-12 z"},{id:"vnm",name:"Vietnam",capital:"Hanoi",flag:"ðŸ‡»ðŸ‡³",flagCode:"vn",isMajor:!0,path:"M565,200 h10 v16 h-10 z"},{id:"phl",name:"Philippines",capital:"Manila",flag:"ðŸ‡µðŸ‡­",flagCode:"ph",isMajor:!0,path:"M590,200 h10 v16 h-10 z"},{id:"mys",name:"Malaysia",capital:"Kuala Lumpur",flag:"ðŸ‡²ðŸ‡¾",flagCode:"my",isMajor:!0,path:"M555,215 h14 v10 h-14 z"},{id:"mmr",name:"Myanmar",capital:"Naypyidaw",flag:"ðŸ‡²ðŸ‡²",flagCode:"mm",isMajor:!0,path:"M540,190 h12 v14 h-12 z"},{id:"nzl",name:"New Zealand",capital:"Wellington",flag:"ðŸ‡³ðŸ‡¿",flagCode:"nz",isMajor:!0,path:"M690,285 h12 v18 h-12 z"}];function ae(n,t={},...a){const i=document.createElement(n);Object.assign(i,t);for(const o of a)i.appendChild(typeof o=="string"?document.createTextNode(o):o);return i}function f(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function ne(n){const t=ae("button",{className:"choice",type:"button"});return t.textContent=n,t}function ie(){const n=document.getElementById("introFlagBanner");if(!n)return;n.innerHTML="";const t=Q.filter(i=>i.flagCode),a=new Set;for(;n.childElementCount<10&&a.size<t.length;){const i=Math.floor(Math.random()*t.length);if(a.has(i))continue;a.add(i);const o=t[i],r=document.createElement("img");r.src=`https://flagcdn.com/w40/${o.flagCode.toLowerCase()}.png`,r.alt=o.name+" flag",r.title=o.name,r.onerror=()=>{r.style.display="none"},n.appendChild(r)}}const e={game:null,selectedCountryId:null,selectedCapitalId:null,mode:"single",p1Name:"Player 1",p2Name:"Player 2",submitted:!1,timerId:null,timeLeft:0,turnSeconds:10,inputEnabledAt:0},N=document.getElementById("introScreen"),oe=document.getElementById("introForm"),v=document.getElementById("introMode"),V=document.getElementById("p1Name"),W=document.getElementById("p2Name");document.getElementById("p1NameField");const E=document.getElementById("p2NameField"),S=document.getElementById("gameRoot"),D=document.getElementById("introTimerSeconds"),z=document.getElementById("mapContainer"),j=document.getElementById("countryChoices"),B=document.getElementById("capitalChoices"),C=document.getElementById("flagEmoji"),c=document.getElementById("feedback");document.getElementById("submitBtn");const re=document.getElementById("newGameBtn"),le=document.getElementById("playAgainBtn"),H=document.getElementById("overlay"),L=document.getElementById("modeSelect"),h=document.getElementById("turnBadge"),I=document.getElementById("playSection"),w=document.getElementById("toast"),g=document.getElementById("playerBanner");document.querySelector("#playSection .top-bar");const y=document.getElementById("surrenderBtn"),l=document.getElementById("turnTimer"),se=document.getElementById("p1Panel"),A=document.getElementById("p2Panel"),$=document.getElementById("p1PanelName"),P=document.getElementById("p2PanelName"),de=document.getElementById("p1PanelScore"),ce=document.getElementById("p2PanelScore"),J=document.getElementById("p1FlagGrid"),Y=document.getElementById("p2FlagGrid");function ue(){N.style.display="",S.style.display="none",E.style.display="none",v.addEventListener("change",()=>{E.style.display=v.value==="two"?"":"none"}),oe.addEventListener("submit",n=>{n.preventDefault(),e.mode=v.value,e.p1Name=V.value.trim()||"Player 1",e.p2Name=W.value.trim()||"Player 2",e.turnSeconds=parseInt(D&&D.value||"10",10),$.textContent=e.p1Name,P.textContent=e.p2Name,me()}),pe()}function me(){N.style.display="none",S.style.display="",L&&(L.value=e.mode),$.textContent=e.p1Name,P.textContent=e.p2Name,A.style.display=e.mode==="two"?"":"none",e.game=new ee(Q),e.game.setMode(e.mode),k(),x(),y&&(y.style.display=e.mode==="two"?"block":"none")}function pe(){re.addEventListener("click",()=>n()),le.addEventListener("click",()=>{ge(),x()}),y&&y.addEventListener("click",()=>{if(e.game&&e.mode==="two"){const i=(e.game.currentPlayer()==="p1"?"p2":"p1")==="p1"?e.p1Name:e.p2Name;O(`${i} wins! ðŸŽ‰`,`${i} wins by surrender.`)}});function n(){p(),N.style.display="",S.style.display="none",V.value="",W.value="",v.value="single",E.style.display="none"}L&&L.addEventListener("change",()=>{e.mode=L.value==="two"?"two":"single",e.game.setMode(e.mode),x()})}function x(){p(),e.game.reset(),e.selectedCapitalId=null,e.selectedCountryId=null,f(j),f(B),c.textContent="",e.submitted=!1,f(J),f(Y),$.textContent=e.p1Name,P.textContent=e.p2Name,A.style.display=e.mode==="two"?"":"none",k(),q(),X(),b(),F(),R(),G()}function k(){f(z);const n=te({countries:e.game.countries,onCountryClick:t=>{const a=n.querySelector(`[data-id="${t}"]`);a&&(n.querySelectorAll(".country").forEach(i=>i.classList.remove("selected")),a.classList.add("selected"))},getFillClass:t=>e.game.getCountryFillClass(t)});z.appendChild(n)}function q(){const n=e.game.nextQuestion();if(!n){O("Game Over","No more countries left.");return}c.classList.remove("centered"),y&&(y.style.display=e.mode==="two"?"block":"none"),b(),C.innerHTML="",e.submitted=!1,e.inputEnabledAt=Date.now()+280,document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur();const t=e.game.pool.find(a=>a.id===e.game.currentTargetId);if(t&&t.flagCode){const a=document.createElement("img"),i=(t.flagCode||"").toLowerCase();a.src=`https://flagcdn.com/w80/${i}.png`,a.alt=t.name+" flag",a.title=t.name+" flag",a.onerror=()=>{const o=document.createElement("div");o.style.width="48px",o.style.height="36px",o.style.borderRadius="6px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.background="#0b1220",o.style.border="1px solid #1f2937",o.style.color="#e5e7eb",o.style.fontSize="12px",o.textContent=t.name.slice(0,3).toUpperCase(),C.innerHTML="",C.appendChild(o)},C.appendChild(a)}else C.textContent=typeof n.flag=="string"&&n.flag.length>0?n.flag:"ðŸ³ï¸";c.textContent="",e.selectedCountryId=null,e.selectedCapitalId=null,[j,B].forEach(a=>{a&&(a.querySelectorAll(".choice").forEach(i=>{i.classList.remove("selected","vanish"),i.blur(),i.disabled=!1}),a.removeAttribute("data-chosen"))}),e.turnSeconds&&e.turnSeconds>0?(ye(e.turnSeconds),l&&(l.style.visibility="")):(p(),l&&(l.style.visibility="hidden")),U(j,n.countryOptions,a=>{e.selectedCountryId=a,K()}),U(B,n.capitalOptions,a=>{e.selectedCapitalId=a,K()}),G()}function U(n,t,a){f(n),n.dataset.chosen="0",t.forEach(i=>{const o=ne(i.label);o.addEventListener("click",()=>{Date.now()<e.inputEnabledAt||e.submitted||n.dataset.chosen!=="1"&&(n.querySelectorAll(".choice").forEach(r=>r.classList.remove("selected")),o.classList.add("selected"),n.dataset.chosen="1",n.querySelectorAll(".choice").forEach(r=>{r!==o&&(r.classList.add("vanish"),r.disabled=!0)}),a(i.id))}),n.appendChild(o)})}function K(){!e.submitted&&e.selectedCapitalId&&e.selectedCountryId&&he()}function he(){if(e.submitted||!e.selectedCapitalId||!e.selectedCountryId)return;e.submitted=!0,p();const n=e.game.currentPlayer(),t=e.game.answer(e.selectedCountryId,e.selectedCapitalId);if(t.correct){let a=n==="p1"?e.p1Name:e.p2Name;e.game.mode==="single"&&(a=e.p1Name),c.textContent=`Correct! Country conquered for ${a}.`,c.className="feedback success",fe(`+1 for ${a}!`),T("correct");const i=e.game.byId(e.game.currentTargetId);if(i&&i.flagCode){const o=document.createElement("div");o.className="flag-chip",o.title=i.name;const r=document.createElement("img"),s=(i.flagCode||"").toLowerCase();r.src=`https://flagcdn.com/w80/${s}.png`,r.alt=i.name+" flag",r.onerror=()=>{o.innerHTML="";const d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center",d.style.fontSize="10px",d.style.color="#e5e7eb",d.textContent=i.name.slice(0,3).toUpperCase(),o.appendChild(d)},o.appendChild(r),(n==="p1"?J:Y).appendChild(o)}}else c.textContent=`Wrong. Correct answer: ${t.correctCountryName} / ${t.correctCapitalName}.`,c.className="feedback error",T("wrong");if(k(),t.correct){const a=z.querySelector("svg"),i=a&&a.querySelector(`[data-id="${e.game.currentTargetId}"]`);i&&(i.classList.add("pulse-win"),setTimeout(()=>i.classList.remove("pulse-win"),820))}if(X(),e.game.isWin()){const a=e.game.winnerPlayer();let i,o;if(a){const r=a==="p1"?e.p1Name:e.p2Name;i=`${r} wins! ðŸŽ‰`,o=`${r} has conquered more than half of the world.`}else i="You win! ðŸŽ‰",o="You have conquered more than half of the world.";O(i,o)}else c.classList.add("centered"),setTimeout(()=>{q(),b(),F(),R()},850),setTimeout(()=>{G()},860)}function O(n,t){p(),l&&(l.classList.remove("warn","danger"),l.style.visibility="hidden"),document.getElementById("overlayTitle").textContent=n,document.getElementById("overlayMessage").textContent=t,H.classList.remove("hidden")}function ge(){H.classList.add("hidden")}function b(){if(!h)return;const n=e.game.currentPlayer();e.game.mode==="single"?(h.textContent="Single Player",h.classList.remove("p1","p2")):(h.textContent=`Turn: ${n.toUpperCase()}`,h.classList.toggle("p1",n==="p1"),h.classList.toggle("p2",n==="p2"))}function X(){de.textContent=e.game.score("p1").toString(),ce.textContent=e.game.score("p2").toString()}function F(){const n=e.game.currentPlayer();if(e.game.mode==="single"){I.classList.remove("p1","p2");return}I.classList.toggle("p1",n==="p1"),I.classList.toggle("p2",n==="p2")}function R(){if(!g)return;if(l&&l.classList.remove("warn","danger"),e.game.mode==="single"){g.textContent=e.p1Name,g.classList.remove("p1","p2");return}const n=e.game.currentPlayer(),t=n==="p1"?e.p1Name:e.p2Name;g.textContent=t,g.classList.toggle("p1",n==="p1"),g.classList.toggle("p2",n==="p2")}function G(){const n=e.game.currentPlayer();se.classList.toggle("active",e.game.mode!=="single"&&n==="p1"),A.classList.toggle("active",e.game.mode!=="single"&&n==="p2")}function T(n){try{const t=new(window.AudioContext||window.webkitAudioContext),a=t.createOscillator(),i=t.createGain();a.connect(i),i.connect(t.destination),a.type="sine",n==="correct"?(a.frequency.value=880,i.gain.setValueAtTime(1e-4,t.currentTime),i.gain.exponentialRampToValueAtTime(.2,t.currentTime+.01),i.gain.exponentialRampToValueAtTime(1e-4,t.currentTime+.18),a.start(),a.stop(t.currentTime+.2)):(a.frequency.value=220,a.type="triangle",i.gain.setValueAtTime(1e-4,t.currentTime),i.gain.exponentialRampToValueAtTime(.18,t.currentTime+.01),i.gain.exponentialRampToValueAtTime(1e-4,t.currentTime+.22),a.start(),a.stop(t.currentTime+.25))}catch{}}function fe(n){w.textContent=n,w.classList.add("show"),setTimeout(()=>w.classList.remove("show"),1e3)}function ye(n){l&&(p(),e.timeLeft=n,l.textContent=e.timeLeft.toString(),l.classList.remove("warn","danger"),e.timerId=setInterval(()=>{e.timeLeft-=1,e.timeLeft<=0?(l.textContent="0",l.classList.add("danger"),p(),Ce()):(l.textContent=e.timeLeft.toString(),e.timeLeft<=2?(l.classList.add("danger"),l.classList.remove("warn")):e.timeLeft<=4&&l.classList.add("warn"))},1e3))}function p(){e.timerId&&(clearInterval(e.timerId),e.timerId=null)}function Ce(){e.submitted||(e.selectedCountryId=null,e.selectedCapitalId=null,e.submitted=!0,T("wrong"),c.textContent="Time's up!",c.className="feedback warn",c.classList.add("centered"),e.game.skip(),setTimeout(()=>{q(),b(),F(),R()},850))}document.addEventListener("DOMContentLoaded",()=>{ie(),ue()});
